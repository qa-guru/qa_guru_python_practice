# Часть 6. Anti-fragile selectors (Антихрупкие локаторы)
Антихрупкий локатор — это локатор, который остаётся работоспособным даже при значимых изменениях DOM, CSS, структуры вёрстки или поведения фреймворка. Такие локаторы устойчивы к частичному ререндеру, перестановкам узлов, A/B‑экспериментам, условной видимости и динамическим состояниям элементов.
Антихрупкость особенно важна для SPA‑приложений (React, Next.js, Vue, Angular), где DOM обновляется выборочно, а элементы часто пересоздаются.

---

## Антихрупкие стратегии ожиданий (Selenium)
Локатор остаётся надёжным только при корректных ожиданиях состояния.

**Распространённые стратегии:**
- ожидание кликабельности;
- ожидание видимости;
- ожидание изменения атрибута;
- ожидание количества элементов.

**Пример:**
```python
WebDriverWait(driver, 10).until(
    EC.visibility_of_element_located((By.CSS_SELECTOR, "[data-qa='submit']"))
)
```


## Принципы антихрупкого локатора
- Использование устойчивых атрибутов
- Независимость от структуры
- Выполнять поиск элемента непосредственно перед действием (Playwright Locator, повторный поиск в Selenium)
- Не хранить `WebElement` дольше, чем требуется
- Не кликать по вложенным тегам (`span`, `svg`), а использовать сам контейнер `button[type="button"]`
- Учитывать сортировки и фильтрации, данные могут менять:
    - порядок строк
    - порядок колонок
    - набор отображаемых элементов
    - антихрупкий локатор должен привязываться к бизнес‑данным, а не к позиции в таблице.
- Учитывать особенности элементов:
  - элемент может появится сразу, но его атрибуты могут применяться позже
  - процесс подгрузки данных может менять структуру DOM
  - skeleton и предварительные слои могут отображаются параллельно с контентом
  - часть DOM может быть скрыта, но оставаться в структуре
- Использовать устойчивый подход для повторяющихся элементов: `.product-card [data-qa="buy"]`



